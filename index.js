import { join, dirname } from "path";
import { createRequire } from "module";
import { fileURLToPath } from "url";
import { setupMaster, fork } from "cluster";
import { existsSync, writeFileSync } from "fs";
import cfonts from "cfonts";
import { createInterface } from "readline";
import chalk from "chalk";

console.log(chalk.bold.hex("#00FFFF")("\n­ЪљгРћђ Iniciando Dolphin-Bot IA Рћђ­Ъљг"));

const __dirname = dirname(fileURLToPath(import.meta.url));
const require = createRequire(__dirname);
require(join(__dirname, "./package.json"));

const rl = createInterface({
  input: process.stdin,
  output: process.stdout,
});

async function barraCargaCyberpunk() {
  const frames = [
    "[­Ъїі] Inicializando Dolphin-Core...",
    "[­ЪЊА] Sincronizando sensores marinos...",
    "[­Ъљг] Activando red neuronal acu├Аtica...",
    "[­ЪФД] Procesando corrientes de datos...",
    "[­ЪДа] Calibrando inteligencia adaptativa...",
    "[РџЎ№ИЈ] Estabilizando sistema aut├│nomo...",
    "[РюЁ] DOLPHIN-BOT LISTO PARA OPERAR.",
  ];

  for (let frame of frames) {
    process.stdout.write("\r" + chalk.cyanBright(frame));
    await new Promise((res) => setTimeout(res, 350));
  }
  console.log();
}

async function animacionDolphinBot() {
  const frames = [
    chalk.hex("#2C5F8D")(`
РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ
РађРађРађРађРађРбђРБђРБђРБђРБђРађРађРађРађРађРађРађРађРађРађРађРађРађРађ
РађРађРађРБаРБЙРБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБдРАђРађРађРађРађРађРађРађРађРађРађРађ
РађРађРБ░РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РАёРађРађРађРађРађРађРађРађРађРађ
РађРбаРБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РађРађРађРађРађРађРађРађРађРађ
РађРбИРБ┐РБ┐РБ┐Ра┐Ра┐Ра┐Ра┐Ра┐Ра┐Ра┐РаЪРаІРађРађРађРађРађРађРађРађРађРађ
РађРаўРа┐РаІРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ
РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ
        DOLPHINBOT v1.0
       РЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕ
`),
    chalk.hex("#3A7BC8")(`
РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ
РађРађРађРађРађРађРБђРБцРБцРБцРБцРБђРађРађРађРађРађРађРађРађРађРађРађРађ
РађРађРађРађРБаРБЙРБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБиРБёРађРађРађРађРађРађРађРађРађРађ
РађРађРађРБ░РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБДРађРађРађРађРађРађРађРађРађ
РађРађРбђРБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РАЄРађРађРађРађРађРађРађРађ
РађРађРбИРБ┐РБ┐РБ┐РБ┐Ра┐Ра┐Ра┐Ра┐Ра┐Ра┐РаЪРаЏРаЂРађРађРађРађРађРађРађРађ
РађРађРаѕРа┐РаЪРаІРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ
РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ
      ­Ъїі Inicializando... ­Ъїі
       РЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕ
`),
    chalk.hex("#4A9FE2")(`
РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ
РађРађРађРаљРб┐РБ┐РБ┐РБ┐РБ┐РБХРБцРБцРБцРБцРБцРБђРађРађРађРађРађРађРађРађ
РађРађРађРађРађРаЎРБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБдРАђРађРађРађРађРађ
РађРађРађРађРБаРБЙРБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБдРађРађРађРађ
РађРађРађРБИРБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБиРађРађРађ
РађРађРб░РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РА┐Ра┐Ра┐Ра┐Ра┐Ра┐РаЪРаЃРађРађ
РађРађРбИРБ┐РБ┐РБ┐РБ┐РА┐РаЏРаЅРаЂРађРбИРБ┐Ра┐РаЂРађРађРађРађРађРађРађРађ
РађРађРбИРБ┐РБ┐РА┐РаІРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ
     ­Ъїі Conectando n├║cleo... ­Ъїі
       РЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕ
`),
    chalk.hex("#5AB9FF")(`
РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ
РађРађРађРаљРб┐РБ┐РБ┐РБ┐РБ┐РБХРБцРБцРБцРБцРБцРБђРађРађРађРађРађРађРађРађ
РађРађРађРађРађРаЎРБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБдРАђРађРађРађРађРађ
РађРађРађРађРБаРБЙРБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБдРађРађРађРађ
РађРађРађРБИРБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБиРБдРађРађ
РађРађРб░РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РА┐Ра┐Ра┐Ра┐Ра┐Ра┐Ра┐РаЪРаЃРађ
РађРађРбИРБ┐РБ┐РБ┐РБ┐РА┐РаЏРаЅРаЂРађРбИРБ┐Ра┐РаЂРађРађРађРађРађРађРађРађ
РађРађРбИРБ┐РБ┐РА┐РаІРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ
РађРађРбИРБ┐РБ┐РаЂРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ
    ­Ъїі Cargando protocolos... ­Ъїі
       РЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕ
`),
    chalk.hex("#00BFFF")(`
РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ
РађРађРађРаљРб┐РБ┐РБ┐РБ┐РБ┐РБХРБцРБцРБцРБцРБцРБђРађРађРађРађРађРађРађРађ
РађРађРађРађРађРаЎРБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБдРАђРађРађРађРађРађ
РађРађРађРађРБаРБЙРБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБдРађРађРађРађ
РађРађРађРБИРБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБиРБдРађРађ
РађРађРб░РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РА┐Ра┐Ра┐Ра┐Ра┐Ра┐Ра┐РаЪРаЃРађ
РађРађРбИРБ┐РБ┐РБ┐РБ┐РА┐РаЏРаЅРаЂРађРбИРБ┐Ра┐РаЂРађРађРађРађРађРађРађРађ
РађРађРбИРБ┐РБ┐РА┐РаІРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ
РађРађРбИРБ┐РБ┐РаЂРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ
РбђРБЙРБ┐РБ┐РБ┐РБиРБдРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ
    ­ЪїіРюе Activando sistema... Рюе­Ъїі
       РЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕ
`),
    chalk.hex("#00CED1")(`
РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ
РађРађРађРаљРб┐РБ┐РБ┐РБ┐РБ┐РБХРБцРБцРБцРБцРБцРБђРађРађРађРађРађРађРађРађ
РађРађРађРађРађРаЎРБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБдРАђРађРађРађРађРађ
РађРађРађРађРБаРБЙРБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБдРађРађРађРађ
РађРађРађРБИРБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБиРБдРађРађ
РађРађРб░РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РА┐Ра┐Ра┐Ра┐Ра┐Ра┐Ра┐РаЪРаЃРађ
РађРађРбИРБ┐РБ┐РБ┐РБ┐РА┐РаЏРаЅРаЂРађРбИРБ┐Ра┐РаЂРађРађРађРађРађРађРађРађ
РађРађРбИРБ┐РБ┐РА┐РаІРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ
РађРађРбИРБ┐РБ┐РаЂРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ
РбђРБЙРБ┐РБ┐РБ┐РБиРБдРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ
РБЙРБ┐РБ┐РБ┐Ра┐РБ┐РБ┐РБиРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ
РА┐РаЏРаЅРађРађРађРаѕРаЎРаЃРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ
    
    ­Ъљг­ЪњЎ DOLPHINBOT READY! ­ЪњЎ­Ъљг
    РЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕРЅѕ
      ┬АSistema Operativo!
`),
  ];

  const duracionTotal = 3000;
  const delay = Math.floor(duracionTotal / frames.length);
  
  for (let i = 0; i < frames.length; i++) {
    console.clear();
    console.log(frames[i]);
    await new Promise((res) => setTimeout(res, delay));
  }
}

async function iniciarDolphinBot() {
  console.clear();

  console.log(
    chalk.bold.cyanBright("\nРЪд Рїг ACCESO CONCEDIDO | DOLPHIN-BOT V.1 РЪД")
  );
  console.log(chalk.gray("Рїг ­ЮўЙ­ЮЎќ­ЮЎБ­ЮЎќ­ЮЎА­ЮЎъ­ЮЎ»­ЮЎќ­ЮЎБ­ЮЎЎ­ЮЎц ­ЮЎќ­ЮЎў­ЮЎў­ЮЎџ­ЮЎе­ЮЎц ­ЮЎќ­ЮЎА ­ЮЎќ­ЮЎД­ЮЎД­ЮЎџ­ЮЎў­ЮЎъ­ЮЎЏ­ЮЎџ..."));
  await new Promise((res) => setTimeout(res, 600));

  await animacionDolphinBot();

  await barraCargaCyberpunk();
  await new Promise((res) => setTimeout(res, 500));

  console.log(chalk.redBright("\nРў░РюдРў░РЋљРў░  ­Юў┐­ЮЎі­ЮЎЄ­ЮЎІ­ЮЎЃ­ЮЎё­ЮЎЅ-­Юўй­ЮЎі­ЮЎЈ  Рў░РЋљРў░РюдРў░"));
  await new Promise((res) => setTimeout(res, 700));

  cfonts.say("El mejor Bot ", {
    font: "block",
    align: "center",
    colors: ["#00FFFF", "#FF00FF"],
    letterSpacing: 1,
  });

  console.log(
    chalk.bold.hex("#00FFFF")(`
РќѕРќђРќђРќђРќђРќђРќђРќђРќђРќђРќђРќђРќђРќђРќђРќђРќђРќђРќђРќђРќђРќѕ
РќѕРќЉРќЉРЋдРћђРЋдРЋћРЋЌРЋдРћђРЋћРЋЌРЋћРЋЌРЋћРЋдРЋЌРЋћРЋЌРќЉРќЉРќѕ
РќѕРќЉРќЉРЋЉРЋЉРЋЉРЋаРћђРЋЉРћђРЋЉРћђРЋЉРЋЉРЋЉРЋЉРЋЉРЋаРћђРќЉРќЉРќѕ
РќѕРќЉРќЉРЋџРЋЕРЋЮРЋџРЋЮРЋџРЋЮРЋџРЋЮРЋџРЋЮРЋЕРћђРЋЕРЋџРЋЮРќЉРќЉРќѕ
РќѕРќёРќёРќёРќёРќёРќёРќёРќёРќёРќёРќёРќёРќёРќёРќёРќёРќёРќёРќёРќёРќѕ
        [ ACCESO CONCEDIDO ]
  `)
  );

  await new Promise((res) => setTimeout(res, 800));

  console.log(chalk.bold.hex("#FF00FF")("\nРїгРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРїг"));
  console.log(
    chalk.bold.white("      SISTEMA CREO POR: ") +
      chalk.bold.hex("#FFD700")("Carlos G")
  );
  console.log(chalk.bold.hex("#FF00FF")("РїгРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРЋљРїг\n"));

  await new Promise((res) => setTimeout(res, 1200));
}

let isRunning = false;
function start(file) {
  if (isRunning) return;
  isRunning = true;
  let args = [join(__dirname, "n├║cleoРђбdolphin", file), ...process.argv.slice(2)];
  setupMaster({ exec: args[0], args: args.slice(1) });
  let p = fork();
  p.on("exit", (_, code) => {
    isRunning = false;
    if (code !== 0) start(file);
  });
}

const archivoArranque = "./.arranque-ok";
if (!existsSync(archivoArranque)) {
  await iniciarDolphinBot();
  writeFileSync(archivoArranque, "CARLOS_FINAL");
}

start("start.js");
